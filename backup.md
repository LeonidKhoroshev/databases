# Домашнее задание к занятию «Резервное копирование баз данных» - Леонид Хорошев


---

### Задание 1. Резервное копирование

### Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день - тут возможны варианты. В случае, если полный бэкап был осуществлен сравнительно недавно, то подойдет комбинация из полного бэкапа и инкрементных бэкапов, выполненных с момента полного резервного копирования до предыдущего дня включительно. Если полный бэкап выполнен достаточно давно, то следует применять комбинацию из полного резеравного копирования и дифференциального бэкапа, так как данная комбинация будет надежней, чем большое количество инкрементных бэкапов. 

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки - горячее резервирование (позволяет восстаннавливать данные до определенного момента времени). Создание резервной копии файлов пользователя происходит в интерактивном режиме по мере их изменения. Система сканирует указанные ей директории и переносит их в архив, после чего следит за происходящим в файловой системе и мере обнаружения изменений также архивирует их. При данном подходе возможно некорректное отображение данных, так как при копировании содержимое базы данных может меняться, однако это единственный возможный вариант для восстановления информации в требуемые сроки (если только полный бэкап не был выполнен за час до поломки).

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных - возможен в случае наличия репликации (master-slave) и развертывания бэкапа со slave-сервера, так как время отставания slave от master-сервера незначительное.  По условиям задания мы имеем дело с финансовой компанией, это значит, что любая потеря данных не допускается. Следовательно требуется настроить синхронную репликацию (процесс дублирования данных в реальном времени через сеть таким образом, чтобы существовало несколько актуальных копий). Запись данных должна делаться одновременно в разные локации. Операция не завершится, пока данные не будут записаны и сохранены на другие копии. При этом оборудование, серверы, хранилища на точках также полностью идентичны для того, чтобы при переходе реплика могла справиться с той же нагрузкой, что и основная база.


---

### Задание 2. PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

Резервное копирование базы данных с одного хоста на другой.

```sql
pg_dump -h hostname_1 dbname | psql -h hostname2 dbname
```

Восстановление базы данных из дамп-файла возможно двумя командами:

```sql
psql dbname < dump_file
```

```sql
pg_restore -U username -d dbname -v "dump_file"
```

Pg_restore от psql отличается при восстановлении базы тем, что psql используется при восстановлении дампа, сделанного в формате plain, а pg_restore — при восстановлении дампа, сделанного в других форматах.

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

*Приведите ответ в свободной форме.*

---

### Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.



3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

*Приведите ответ в свободной форме.*

---
